<script>
document.addEventListener('DOMContentLoaded', function() {

    function updatePlaceholder() {
        const unitTypeRadio = document.querySelector('input[name="unitType"]:checked');
        
        if (!unitTypeRadio) {
            console.warn('Nenhum radio "unitType" selecionado. For√ßando "bytes".');
            const fallback = document.querySelector('input[name="unitType"][value="bytes"]');
            if (fallback) fallback.checked = true;
            var isBits = false;
        } else {
            var isBits = unitTypeRadio.value === 'bits';
        }

        const input = document.getElementById('bytesInput');
        const select = document.getElementById('unitSelect');

        if (!input || !select) {
            console.error('Elementos #bytesInput ou #unitSelect n√£o encontrados!');
            return;
        }

        input.placeholder = `Digite o valor em ${isBits ? 'Bits' : 'Bytes'}`;

        select.innerHTML = '';

        if (isBits) {
            select.innerHTML = `
                <option value="b">Bits (b)</option>
                <option value="Kb">Kilobits (Kb)</option>
                <option value="Mb" selected>Megabits (Mb)</option>
                <option value="Gb">Gigabits (Gb)</option>
                <option value="Tb">Terabits (Tb)</option>
                <option value="Pb">Petabits (Pb)</option>
            `;
        } else {
            select.innerHTML = `
                <option value="B">Bytes (B)</option>
                <option value="KB">Kilobytes (KB)</option>
                <option value="MB" selected>Megabytes (MB)</option>
                <option value="GB">Gigabytes (GB)</option>
                <option value="TB">Terabytes (TB)</option>
                <option value="PB">Petabytes (PB)</option>
            `;
        }
    }

    function convertBytes() {
        const inputElem = document.getElementById('bytesInput');
        if (!inputElem) {
            console.error('Elemento #bytesInput n√£o encontrado!');
            return;
        }

        const value = parseFloat(inputElem.value);
        if (isNaN(value)) {
            const resultDiv = document.getElementById('bytesResult');
            if (resultDiv) {
                resultDiv.innerHTML = `
                    <div style="background: #330000; color: #ff5252; padding: 15px; border-radius: 6px; border: 1px solid #ff5252;">
                        ‚ùå Por favor, digite um n√∫mero v√°lido
                    </div>
                `;
            }
            return;
        }

        const unitTypeRadio = document.querySelector('input[name="unitType"]:checked');
        if (!unitTypeRadio) {
            console.error('Nenhum radio "unitType" encontrado ou selecionado!');
            return;
        }

        const isBits = unitTypeRadio.value === 'bits';
        const selectElem = document.getElementById('unitSelect');
        if (!selectElem) {
            console.error('Elemento #unitSelect n√£o encontrado!');
            return;
        }

        const unit = selectElem.value;
        const base = 1000; // Base decimal (padr√£o de redes e armazenamento)
        
        // Converte para bits brutos (valor base)
        let baseBits = value;
        if (isBits) {
            switch (unit) {
                case 'Kb': baseBits *= base; break;
                case 'Mb': baseBits *= Math.pow(base, 2); break;
                case 'Gb': baseBits *= Math.pow(base, 3); break;
                case 'Tb': baseBits *= Math.pow(base, 4); break;
                case 'Pb': baseBits *= Math.pow(base, 5); break;
            }
        } else {
            switch (unit) {
                case 'KB': baseBits *= base * 8; break;
                case 'MB': baseBits *= Math.pow(base, 2) * 8; break;
                case 'GB': baseBits *= Math.pow(base, 3) * 8; break;
                case 'TB': baseBits *= Math.pow(base, 4) * 8; break;
                case 'PB': baseBits *= Math.pow(base, 5) * 8; break;
                default: baseBits *= 8; // B ‚Üí bits
            }
        }

        let resultHTML = `
            <div style="background: #121212; padding: 15px; border-radius: 6px; border: 1px solid #333;">
                <div style="color: #8bc34a; font-weight: bold; margin-bottom: 10px;">‚úÖ Convers√£o Completa (${isBits ? 'Bits' : 'Bytes'})</div>
        `;

        if (isBits) {
            const units = [
                { unit: 'b', name: 'Bits', factor: 1 },
                { unit: 'Kb', name: 'Kilobits', factor: base },
                { unit: 'Mb', name: 'Megabits', factor: Math.pow(base, 2) },
                { unit: 'Gb', name: 'Gigabits', factor: Math.pow(base, 3) },
                { unit: 'Tb', name: 'Terabits', factor: Math.pow(base, 4) },
                { unit: 'Pb', name: 'Petabits', factor: Math.pow(base, 5) }
            ];

            units.forEach(item => {
                const converted = baseBits / item.factor;
                resultHTML += `
                    <div style="margin: 8px 0; padding: 8px; background: #1a2a1a; border-radius: 4px;">
                        <span style="color: #8bc34a;">${item.name}:</span> ${converted.toLocaleString('en-US', { maximumFractionDigits: 3, minimumFractionDigits: 0 })} ${item.unit}
                        <div style="font-size: 0.9em; color: #aaa; margin-top: 4px;"># ${getBitExplanation(item.unit)}</div>
                    </div>
                `;
            });
        } else {
            const units = [
                { unit: 'B', name: 'Bytes', factor: 8 },
                { unit: 'KB', name: 'Kilobytes', factor: base * 8 },
                { unit: 'MB', name: 'Megabytes', factor: Math.pow(base, 2) * 8 },
                { unit: 'GB', name: 'Gigabytes', factor: Math.pow(base, 3) * 8 },
                { unit: 'TB', name: 'Terabytes', factor: Math.pow(base, 4) * 8 },
                { unit: 'PB', name: 'Petabytes', factor: Math.pow(base, 5) * 8 }
            ];

            units.forEach(item => {
                const converted = baseBits / item.factor;
                resultHTML += `
                    <div style="margin: 8px 0; padding: 8px; background: #1a2a1a; border-radius: 4px;">
                        <span style="color: #8bc34a;">${item.name}:</span> ${converted.toLocaleString('en-US', { maximumFractionDigits: 3, minimumFractionDigits: 0 })} ${item.unit}
                        <div style="font-size: 0.9em; color: #aaa; margin-top: 4px;"># ${getByteExplanation(item.unit)}</div>
                    </div>
                `;
            });
        }

        resultHTML += `
            </div>
            <div style="background: #1a2a1a; color: #8bc34a; padding: 10px; border-radius: 6px; margin-top: 15px; border: 1px solid #333;">
                üí° <strong>Dica de Sysadmin:</strong> Redes usam bits (Mbps), armazenamento usa bytes (MB). 100 Mbps = 12.5 MB/s!
            </div>
        `;

        const resultDiv = document.getElementById('bytesResult');
        if (resultDiv) {
            resultDiv.innerHTML = resultHTML;
        } else {
            console.error('Elemento #bytesResult n√£o encontrado!');
        }
    }

    function getBitExplanation(unit) {
        const explanations = {
            'b': 'Bit - unidade b√°sica',
            'Kb': 'Kilobit - 1.000 bits (padr√£o redes)',
            'Mb': 'Megabit - 1.000.000 bits (velocidade internet)',
            'Gb': 'Gigabit - 1.000.000.000 bits (redes 1Gbps)',
            'Tb': 'Terabit - 1.000.000.000.000 bits (backbones)',
            'Pb': 'Petabit - 1.000.000.000.000.000 bits (data centers)'
        };
        return explanations[unit] || '';
    }

    function getByteExplanation(unit) {
        const explanations = {
            'B': 'Byte - 8 bits',
            'KB': 'Kilobyte - 1.000 bytes (arquivos pequenos)',
            'MB': 'Megabyte - 1.000.000 bytes (m√∫sicas, fotos)',
            'GB': 'Gigabyte - 1.000.000.000 bytes (filmes, jogos)',
            'TB': 'Terabyte - 1.000.000.000.000 bytes (discos r√≠gidos)',
            'PB': 'Petabyte - 1.000.000.000.000.000 bytes (data centers)'
        };
        return explanations[unit] || '';
    }

    // INICIALIZA
    updatePlaceholder();

    // ADICIONA LISTENERS NOS RADIOS
    document.querySelectorAll('input[name="unitType"]').forEach(radio => {
        radio.addEventListener('change', updatePlaceholder);
    });

    // ‚úÖ CORRE√á√ÉO PRINCIPAL: Listener no bot√£o
    const convertButton = document.getElementById('convertButton');
    if (convertButton) {
        convertButton.addEventListener('click', convertBytes);
    }

    // Opcional: Converter com Enter
    const inputElem = document.getElementById('bytesInput');
    if (inputElem) {
        inputElem.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                convertBytes();
            }
        });
    }

});
</script>
