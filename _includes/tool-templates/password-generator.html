<script>
function updateLengthValue() {
    const passLengthElem = document.getElementById('passLength');
    const lengthValueElem = document.getElementById('lengthValue');
    
    // ✅ Verificação de segurança
    if (!passLengthElem || !lengthValueElem) {
        console.error('Elementos #passLength ou #lengthValue não encontrados!');
        return;
    }
    
    const length = passLengthElem.value;
    lengthValueElem.innerText = length;
    generatePassword();
}

function generatePassword() {
    const passLengthElem = document.getElementById('passLength');
    const includeSymbols = document.getElementById('includeSymbols');
    const includeNumbers = document.getElementById('includeNumbers');
    const includeLowercase = document.getElementById('includeLowercase');
    const includeUppercase = document.getElementById('includeUppercase');
    const passwordResult = document.getElementById('passwordResult');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');

    // ✅ Verificação de segurança
    if (!passLengthElem || !passwordResult || !strengthBar || !strengthText) {
        console.error('Elementos obrigatórios não encontrados!');
        return;
    }

    const length = parseInt(passLengthElem.value);
    const includeSymbolsChecked = includeSymbols?.checked ?? false;
    const includeNumbersChecked = includeNumbers?.checked ?? false;
    const includeLowercaseChecked = includeLowercase?.checked ?? false;
    const includeUppercaseChecked = includeUppercase?.checked ?? false;

    let chars = '';
    if (includeLowercaseChecked) chars += 'abcdefghijklmnopqrstuvwxyz';
    if (includeUppercaseChecked) chars += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    if (includeNumbersChecked) chars += '0123456789';
    if (includeSymbolsChecked) chars += '!@#$%^&*()_+-=[]{}|;:,.<>?';

    if (chars === '') {
        passwordResult.innerText = '❌ Selecione pelo menos um tipo de caractere!';
        strengthBar.style.width = '0%';
        strengthBar.style.background = '#ff5252';
        strengthText.innerText = 'Força: Nenhuma';
        return;
    }

    let password = '';
    for (let i = 0; i < length; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    passwordResult.innerText = password;

    // Calcula força da senha
    let strength = 0;
    if (length >= 12) strength += 25;
    if (length >= 16) strength += 25;
    if (includeLowercaseChecked && includeUppercaseChecked) strength += 17;
    if (includeNumbersChecked) strength += 17;
    if (includeSymbolsChecked) strength += 16;

    strengthBar.style.width = `${strength}%`;
    strengthText.innerText = `Força: ${getStrengthText(strength)}`;
    
    if (strength < 30) {
        strengthBar.style.background = '#ff5252';
    } else if (strength < 60) {
        strengthBar.style.background = '#ff9800';
    } else if (strength < 80) {
        strengthBar.style.background = '#4caf50';
    } else {
        strengthBar.style.background = '#8bc34a';
    }
}

function getStrengthText(strength) {
    if (strength < 30) return 'Fraca';
    if (strength < 60) return 'Média';
    if (strength < 80) return 'Forte';
    return 'Muito Forte';
}

function copyPassword() {
    const passwordResult = document.getElementById('passwordResult');
    if (!passwordResult) {
        console.error('Elemento #passwordResult não encontrado!');
        return;
    }
    
    const password = passwordResult.innerText;
    if (password && !password.includes('❌')) {
        navigator.clipboard.writeText(password).then(() => {
            alert('✅ Senha copiada para a área de transferência!');
            window.getSelection().removeAllRanges();
        }).catch(() => {
            alert('❌ Falha ao copiar. Tente manualmente.');
        });
    } else {
        alert('⚠️ Nenhuma senha válida para copiar.');
    }
}

// ✅ Garante que o DOM está carregado antes de executar
document.addEventListener('DOMContentLoaded', function() {
    // Verifica se os elementos existem antes de tentar usar
    const passLengthElem = document.getElementById('passLength');
    if (passLengthElem) {
        // Atualiza ao mudar o slider
        passLengthElem.addEventListener('input', updateLengthValue);
        // Gera senha inicial
        updateLengthValue();
    } else {
        console.error('Elemento #passLength não encontrado! Verifique seu HTML.');
    }
});
</script>
