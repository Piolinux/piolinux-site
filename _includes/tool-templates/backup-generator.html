<script>
function generateBackupCommand() {
    const type = document.getElementById('backupType').value;
    const source = document.getElementById('sourcePath').value.trim();
    const dest = document.getElementById('destPath').value.trim();
    let command = '';
    let explanation = '';
    let warning = '';

    switch (type) {
        case 'tar':
            if (source && dest) {
                // Usa caminho relativo expl√≠cito para evitar risco
                command = `tar -czvf ${dest} -C ${source} .`;
                explanation = `# -C: muda para diret√≥rio antes de empacotar (evita caminhos absolutos)`;
                warning = 'üí° Dica: Use --exclude="*.log" para ignorar logs.';
            } else {
                command = '‚ùå Preencha origem e destino';
            }
            break;
        case 'rsync':
            if (source && dest) {
                command = `rsync -avz --progress ${source}/ ${dest}/`;
                explanation = `# -a: modo archive (preserva permiss√µes, links, etc.) | -v: verbose | -z: compress√£o durante transfer√™ncia`;
                warning = '‚ö†Ô∏è Teste com <code>--dry-run</code> primeiro para evitar sobrescrita acidental.';
            } else {
                command = '‚ùå Preencha origem e destino';
            }
            break;
        case 'dd':
            if (source && dest) {
                // Adiciona aviso expl√≠cito no pr√≥prio comando
                command = `# ‚ö†Ô∏è CONFIRME: ${source} √© a fonte e ${dest} √© o destino!\ndd if=${source} of=${dest} bs=4M status=progress oflag=sync`;
                explanation = `# if: arquivo de entrada | of: arquivo de sa√≠da | bs: tamanho do bloco | oflag=sync: escrita f√≠sica garantida`;
                warning = 'üö® PERIGO: Um erro de digita√ß√£o pode apagar dados permanentemente. Nunca use em discos do sistema sem backup.';
            } else {
                command = '‚ùå Preencha origem e destino';
            }
            break;
        case 'mysqldump':
            if (dest) {
                command = `mysqldump -u usuario -p banco > ${dest}`;
                explanation = `# Substitua "usuario" e "banco" pelos seus valores reais`;
                warning = 'üîê Seguran√ßa: Nunca coloque senhas no comando. Use <code>~/.my.cnf</code> com permiss√µes 600.';
            } else {
                command = '‚ùå Preencha destino';
            }
            break;
        default:
            command = '‚ùå Selecione um tipo de backup';
    }

    // Atualiza interface
    document.getElementById('backupResult').innerHTML = `
        <div style="font-family: monospace; font-size: 1.1em; color: #8bc34a; margin-bottom: 8px; white-space: pre-wrap;">
            ${command}
        </div>
        ${explanation ? `<div style="font-size: 0.9em; color: #aaa; margin-bottom: 8px;">${explanation}</div>` : ''}
        ${warning ? `<div style="font-size: 0.9em; color: #ffcc00; font-weight: bold;">${warning}</div>` : ''}
    `;
}

function copyBackupCommand() {
    const resultDiv = document.getElementById('backupResult');
    const fullText = resultDiv.innerText;
    
    if (fullText && !fullText.includes('‚ùå') && !fullText.includes('‚ö†Ô∏è CONFIRME')) {
        // Extrai s√≥ a linha do comando real (ignora coment√°rios de aviso)
        const lines = fullText.split('\n');
        let cmdLine = lines[0];
        if (lines.length > 1 && !lines[0].startsWith('dd')) {
            cmdLine = lines[1]; // para dd, a linha do comando √© a segunda
        }
        navigator.clipboard.writeText(cmdLine).then(() => {
            alert('‚úÖ Comando copiado!');
        }).catch(() => {
            alert('‚ùå Falha ao copiar. Tente manualmente.');
        });
    } else if (fullText.includes('‚ö†Ô∏è CONFIRME')) {
        alert('‚ö†Ô∏è Confirme os caminhos antes de copiar o comando dd.');
    } else {
        alert('‚ùå Nenhum comando v√°lido para copiar.');
    }
}
</script>
